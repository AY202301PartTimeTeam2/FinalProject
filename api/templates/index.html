
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.10/dist/sweetalert2.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.js" integrity="sha512-QSb5le+VXUEVEQbfljCv8vPnfSbVoBF/iE+c6MqDDqvmzqnr4KL04qdQMCm0fJvC3gCWMpoYhmvKBFqm1Z4c9A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.10/dist/sweetalert2.all.min.js"></script>

<!doctype html>
<html>
    <head>
        <title>New York Cab Predictor</title>
    </head>
    <body class="bg-light" style="outline: 0; width: 100%; min-width: 100%; height: 100%; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; font-family: Helvetica, Arial, sans-serif; line-height: 24px; font-weight: normal; font-size: 16px; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; color: #000000; margin: 0.5em 2em; padding: 0; border-width: 0; align-self: self-start;" bgcolor="#f7fafc">
        <div class="container">
            <h1>Anyone IApp</h1>
            <br>
            <h3>Travel faster. Travel safer. Travel smarter</h3>
            <hr>
            <br>
            <form class="" name="form-predict" id="form-predict" method="post" action="/" enctype="multipart/form-data" >
                <input type="hidden" id="origin" name="origin"  value="">
                <input type="hidden" id="destination" name="destination" value="">
                <div class="form-group">
                    <h4>Start point</h4>
                    <select name="start_point" id="start_point" class="form-select mb-3" required>
                    {% if pickup_zones %}
                        <ul>
                        {% for origin in pickup_zones %}
                            <option value={{ origin.id}}>{{ origin.zone}}</option>
                        {% endfor %}
                        </ul>
                    {% endif %}
                    </select>
                </div>
                <div class="form-group">
                    <h4>Destination point<h4>
                    <select name="dest_point" id="dest_point" class="form-select mb-3" required>
                    {% if dropoff_zones %}
                        <ul>
                        {% for dest in dropoff_zones %}
                            <option value={{ dest.id}}>{{ dest.zone}}</option>
                        {% endfor %}
                        </ul>
                    {% endif %}
                    </select>
                </div>
                <div class="form-group">
                    <h4>Choose current time<h4>
                    <input type="time" id="time" name="time" min="0" max="23" class="form-control mb-3" required>
                    <small>*Rush hours could affect fare amount</small>
                    <br>
                    <br>
                    <input type="button" name="post_data" onclick="getPrediction()" class="btn btn-primary" value="Get Fare!">
                </div>
            </form>
        </div>        
    </body>
</html>
<script>
    function getPrediction(){
        var origin = document.getElementById("start_point").value;
        var dest = document.getElementById("dest_point").value;
        document.getElementById('origin').value = origin;
        document.getElementById('destination').value = dest;

        var originText = $( "#start_point option:selected" ).text();
        var destText = $( "#dest_point option:selected" ).text();

        if ($("#time").val() == "") {
            Swal.fire(
                'Ups!',
                'Choose a current time',
                'warning'
            )
            return;
        } 

        var data = $("#form-predict").serialize();

        $.ajax({
 
            url:'/',
            type: "POST",
            data: data,
            beforeSend: function(){
                $.blockUI({ message: '<img src="https://icaengineeringacademy.com/wp-content/uploads/2019/01/ajax-loading-gif-transparent-background-2.gif" /><br><h3>Wait a moment ...</h3>' });
            },
            complete: function(){
                $.unblockUI();
            },              
            success: function (data) {

                data.fare = Math.round(parseFloat(data.fare.replace("[","").replace("]","")),2)
                data.duration = Math.round(parseFloat(data.duration.replace("[","").replace("]","")),2)

                Swal.fire({
                    title: 'Here the estimation!',
                    icon: 'info',
                    html:'Fare: $' + data.fare + '<br> Duration: ' + data.duration + '" <br> Start point: ' + originText + '<br> Destination point: ' + destText
                });
            },
            error: function (error) {
                Swal.fire(
                    'Ups!',
                    'Something went wrong!',
                    'warning'
                )
                console.log(`Error ${error}`);
            }
        });
    }
</script>